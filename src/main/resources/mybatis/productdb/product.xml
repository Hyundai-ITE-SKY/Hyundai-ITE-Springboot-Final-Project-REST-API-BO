<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.mycompany.webapp.dao.productdb.ProductDao">
	<select id="countProduct" resultType="int">
		select count(*)
		from product
	</select>
	
	<select id="selectProductList" parameterType="pager" resultType="product">
		SELECT rnum, pno, pid, clarge, cmedium, csmall, pname, bname
		FROM(
			SELECT ROWNUM as rnum, pno, pid, clarge, cmedium, csmall, pname, bname
			FROM(
			    select p.pno as pno, p.pid as pid, p.clarge as clarge, p.cmedium as cmedium, p.csmall as csmall, p.pname as pname, b.bname as bname
		        from product p join brand b
		        on p.bno = b.bno
		        order by p.pno
				)
			WHERE ROWNUM &lt;= #{pager.endRowNo}
			)
		WHERE rnum &gt;= #{pager.startRowNo}
	</select>
	
	<select id="selectProductWithPid" parameterType="string" resultType="product">
		SELECT p.pid as pid, b.bname as bname, p.clarge as clarge,
		p.cmedium as cmedium, p.csmall as csmall,
		p.pno as pno, p.pname as
		pname, p.pprice as pprice, p.pdetail as pdetail, p.pseason as pseason,
		p.ptotalamount as ptotalamount
		FROM product p, brand b
		WHERE pid = #{pid}
		AND b.bno = p.bno
	</select>
	
	<select id="selectProductColors" parameterType="String" resultType="color">
		SELECT
		pid, ccolorcode, cimage1, cimage2, cimage3,
		ccolorimage, cmatchpid
		FROM color
		WHERE pid = #{pid}
	</select>
	
	<select id="selectProductStock" parameterType="HashMap"
		resultType="stock">
		SELECT
		pid, ccolorcode, ssize, samount
		FROM stock
		WHERE pid =
		#{pid}
		AND ccolorcode = #{colorcode}
	</select>
	
	<select id="countStock" resultType="int">
		select count(*) from stock
	</select>
	
	<select id="selectStockList" parameterType="pager" resultType="stocklist">
		SELECT rnum, bname, pid,pname, ccolorcode, ssize, samount, ptotalamount
		FROM(
			SELECT ROWNUM as rnum, bname, pid,pname, ccolorcode, ssize, samount, ptotalamount
			FROM(
			    select b.bname, s.pid,p.pname, s.ccolorcode, s.ssize, s.samount, p.ptotalamount
		        from brand b, product p, stock s
		        where b.bno = p.bno and p.pid = s.pid
		        order by pid
				)
			WHERE ROWNUM &lt;= #{pager.endRowNo}
			)
		WHERE rnum &gt;= #{pager.startRowNo}
	</select>
	
	<update id="updateStock" parameterType="stock">
		update stock
		set samount=#{samount}
		where pid=#{pid} and ccolorcode=#{ccolorcode} and ssize=#{ssize}
	</update>
	
	<delete id="deleteByPid" parameterType="string">
		delete from product where pid=#{pid}
	</delete>
</mapper>
